# Implementation Plan: Smart Local Installation Script System

**Branch**: `001-smart-local-installation` | **Date**: September 16, 2025 | **Spec**: [SPECIFICATION.md](SPECIFICATION.md)
**Input**: Feature specification for comprehensive installation automation system

## Summary

Create intelligent installation scripts that leverage RAGLite's existing GPU acceleration infrastructure to automatically detect system hardware, resolve optimal dependencies, and set up complete development environments. This builds directly upon the completed GPU detection and acceleration work in `_embedding_gpu.py` and `_gpu_utils.py` while solving the critical user onboarding friction identified in the project roadmap.

## Technical Context

**Language/Version**: Python 3.10+ (matches existing codebase), Bash 4.0+, PowerShell 5.1+  
**Primary Dependencies**: Existing RAGLite dependencies + cross-platform system detection libraries  
**Storage**: File-based configuration templates, JSON hardware profiles, `.env` generation  
**Testing**: pytest integration with existing test suite, cross-platform CI validation  
**Target Platform**: Linux (Ubuntu/Debian/RHEL), macOS (Intel/Apple Silicon), Windows 10+  
**Project Type**: Single project with cross-platform installation utilities  
**Performance Goals**: <10 min complete installation, <30 sec GPU detection, 95% success rate  
**Constraints**: No root privileges required, offline-capable after initial download, idempotent  
**Scale/Scope**: Support 5+ OS variants, 3 GPU types, 10+ hardware configurations

## Constitution Check

### Simplicity Gate ✅ PASS
- **Leverages Existing Infrastructure**: Builds upon completed GPU acceleration work rather than reimplementing
- **Single Responsibility**: Focused solely on installation automation, no feature expansion
- **Progressive Enhancement**: Core installation works without GPU, GPU features add optimization

### Reliability Gate ✅ PASS  
- **Graceful Degradation**: GPU detection failure falls back to CPU-only installation
- **Comprehensive Testing**: Validates installation across platform matrix in CI
- **Error Recovery**: Failed installations provide specific recovery paths

### Integration Gate ✅ PASS
- **Respects Existing Patterns**: Uses current configuration approach from `_config.py`
- **Maintains Compatibility**: Works with existing requirements files and dependency structure  
- **Enhances Current Work**: Makes GPU acceleration accessible rather than changing it

## Project Structure

### Documentation (this feature)
```
.github/change_request/
├── SPECIFICATION.md      # Feature specification (completed)
├── plan.md              # This implementation plan  
├── research.md          # Hardware detection research & API analysis
├── data-model.md        # Configuration entities and system detection schemas
├── quickstart.md        # Developer getting started guide
├── contracts/           # API contracts for system detection modules
└── tasks.md             # Detailed implementation tasks (generated by /tasks)
```

### Source Code Integration (repository root)
```
raglite/                 # Main repository
├── install.sh           # NEW: Unix installation entry point
├── install.ps1          # NEW: Windows PowerShell installation  
├── scripts/             # NEW: Installation automation modules
│   ├── detect_system.py        # Cross-platform system detection
│   ├── resolve_dependencies.py # Hardware-specific dependency resolution  
│   ├── venv_manager.py         # Virtual environment management
│   ├── validate_install.py     # Post-installation validation
│   └── hardware_configs/       # JSON configuration templates
│       ├── nvidia_gpu.json     # NVIDIA optimization settings
│       ├── amd_gpu.json        # AMD ROCm settings
│       ├── apple_metal.json    # Apple Silicon settings
│       └── cpu_only.json       # CPU fallback settings
├── .env.template        # NEW: Environment variable template
├── INSTALL.md           # NEW: Comprehensive installation guide
├── src/raglite/         # EXISTING: Core codebase
│   ├── _gpu_utils.py    # EXISTING: GPU detection (leverage for installation)
│   ├── _embedding_gpu.py # EXISTING: GPU acceleration (validate during install)
│   └── _config.py       # EXISTING: Configuration patterns (extend for install)
└── tests/               # EXISTING: Test suite
    ├── test_installation.py    # NEW: Installation script tests
    └── test_gpu_acceleration.py # EXISTING: GPU tests (run during validation)
```

## Phase 0: Research & Discovery

### Hardware Detection Research
**Objective**: Analyze cross-platform GPU detection approaches and dependency resolution patterns

**Key Research Areas**:
1. **GPU Detection APIs**: nvidia-ml-py vs subprocess nvidia-smi, ROCm detection methods, Metal availability
2. **PyTorch Installation Matrix**: CUDA version compatibility, ROCm variants, precompiled wheel URLs  
3. **llama-cpp-python Binaries**: Available accelerator combinations, version compatibility matrix
4. **System Detection Libraries**: Cross-platform OS/architecture detection, Python environment analysis
5. **Installation Best Practices**: Virtual environment patterns, error handling, progress indication

**Deliverable**: `research.md` with API analysis and technical approach recommendations

### Current Infrastructure Analysis  
**Leverage Existing GPU Work**: 
- Study `_gpu_utils.py` detection patterns for installation integration
- Analyze `_embedding_gpu.py` GPU configuration for optimal settings template
- Review `_config.py` patterns for environment variable management
- Examine test failures in TODO.md for installation validation requirements

## Phase 1: Design & Contracts

### Data Model Design
**System Detection Schema**: Define standardized format for hardware detection results
**Configuration Templates**: JSON schemas for hardware-specific optimization settings
**Installation State**: Track installation progress and enable recovery from failures

### API Contracts
**SystemDetector Interface**: Cross-platform hardware detection with consistent output format
**DependencyResolver Interface**: Hardware-to-package mapping with fallback strategies  
**InstallationValidator Interface**: Post-installation testing and verification protocols

### Quick Start Experience
**Developer Onboarding**: Single-command installation flow integrated with existing documentation
**Troubleshooting Guide**: Auto-generated system-specific recovery instructions
**Integration Points**: How installation scripts interact with existing RAGLite infrastructure

### Agent-Specific Implementation Guide
**GitHub Copilot Instructions**: Detailed technical specifications for implementation including:
- Integration patterns with existing GPU detection code
- Error handling strategies that align with current codebase patterns
- Testing approaches that extend existing pytest infrastructure  
- Code style and documentation standards matching project conventions

## Phase 2 Planning: Task Generation Approach

**Task Breakdown Strategy**: 
- **Foundation Tasks**: System detection and dependency resolution core modules
- **Platform-Specific Tasks**: Unix bash script, Windows PowerShell script, cross-platform testing
- **Integration Tasks**: Leverage existing GPU infrastructure, extend current configuration patterns
- **Validation Tasks**: Test suite integration, CI pipeline updates, documentation generation

**Implementation Priority**:
1. **Critical Path**: System detection → dependency resolution → basic installation flow
2. **Platform Support**: Unix/Linux → macOS → Windows PowerShell  
3. **Advanced Features**: Interactive selection → validation testing → error recovery
4. **Polish Phase**: Progress indicators → documentation → CI integration

**Dependencies Management**:
- Build upon completed GPU acceleration infrastructure (TODO.md accomplishments)
- Address model string parsing bug in `GPUAwareLlamaLLM.create` during integration
- Ensure installation validation covers existing test scenarios

## Progress Tracking

### Initial Constitution Check ✅ COMPLETED
- [x] Simplicity: Leverages existing infrastructure, single responsibility
- [x] Reliability: Graceful degradation and comprehensive error handling  
- [x] Integration: Respects existing patterns and enhances current work

### Phase 0 Status: 🔄 READY FOR EXECUTION
- [ ] Hardware detection API research
- [ ] Dependency resolution pattern analysis  
- [ ] Integration points with existing GPU infrastructure identified
- [ ] Technical approach recommendations documented

### Phase 1 Status: ⏳ PENDING PHASE 0
- [ ] Data model schemas defined
- [ ] API contracts specified
- [ ] Quick start experience designed
- [ ] GitHub Copilot implementation guide created
- [ ] Post-design constitution check completed

---

**Next Command**: Run `/tasks` to generate detailed implementation tasks based on this plan
**Ready State**: Phase 0 research can begin immediately upon plan approval
